#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–¥–µ–ª–æ–∫ –≤ –∞–¥–º–∏–Ω–∫–µ

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–¥–µ–ª–æ–∫ –≤ –∞–¥–º–∏–Ω–∫–µ..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω—ã –ª–∏ —Å–µ—Ä–≤–∏—Å—ã
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
if ! curl -s http://localhost:3000/api/health > /dev/null 2>&1; then
    echo "‚ùå Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ: cd backend && bun run dev"
    exit 1
else
    echo "‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

if ! curl -s http://localhost:3001/ > /dev/null 2>&1; then
    echo "‚ùå Frontend –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ: cd frontend && npm run dev"
    exit 1
else
    echo "‚úÖ Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π..."

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω)
ADMIN_TOKEN="${ADMIN_TOKEN:-your-admin-token-here}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
response=$(curl -s -X GET "http://localhost:3000/admin/transactions/attempts" \
    -H "x-admin-key: $ADMIN_TOKEN" \
    -H "Content-Type: application/json")

if echo "$response" | grep -q "data"; then
    echo "‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç /admin/transactions/attempts —Ä–∞–±–æ—Ç–∞–µ—Ç"
    
    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    total=$(echo "$response" | grep -o '"success":true' | wc -l)
    errors=$(echo "$response" | grep -o '"success":false' | wc -l)
    
    echo ""
    echo "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:"
    echo "   - –£—Å–ø–µ—à–Ω—ã—Ö: $total"
    echo "   - –° –æ—à–∏–±–∫–∞–º–∏: $errors"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤"
    echo "   –û—Ç–≤–µ—Ç: $response"
fi

echo ""
echo "üåê –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:"
echo "   http://localhost:3001/admin/deals"
echo ""
echo "üìù –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:"
echo "   1. –í–∫–ª–∞–¥–∫–∞ '–ó–∞–ø—Ä–æ—Å—ã' - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤"
echo "   2. –°—Ç–∞—Ç—É—Å—ã: '–û—à–∏–±–∫–∞' (–∫—Ä–∞—Å–Ω—ã–π), '–£—Å–ø–µ—à–Ω–∞—è —Å–¥–µ–ª–∫–∞' (–∑–µ–ª–µ–Ω—ã–π), '–°–¥–µ–ª–∫–∞' (—Å–∏–Ω–∏–π)"
echo "   3. –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤"
echo "   4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –≤–∫–ª–∞–¥–∫–∏"
echo "   5. Tooltips –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Ç–∞—Ç—É—Å—ã"
echo ""
echo "‚ú® –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!"
