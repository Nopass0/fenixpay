# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

## üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ú–´ –ü–†–ò–ù–ò–ú–ê–ï–ú** —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞ –∏ **–ü–†–ï–î–û–°–¢–ê–í–õ–Ø–ï–ú API** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∞—É–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
1. **–í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã** ‚Üí **–ù–ê–ú**: –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
2. **–ú–´**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π —Ñ–ª–æ—É (—Ç—Ä–µ–π–¥–µ—Ä—ã, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, —Ä–∞—Å—á–µ—Ç—ã)
3. **–ú–´** ‚Üí **–í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã**: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º callback'–∏ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç–∞—Ç—É—Å–æ–≤

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. API Endpoints –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º ‚úÖ
**–§–∞–π–ª**: `backend/src/routes/auction/external-api.ts`

#### Endpoints –∫–æ—Ç–æ—Ä—ã–µ –ú–´ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º:
- `POST /api/auction/external/CreateOrder` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –æ—Ç –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
- `POST /api/auction/external/CancelOrder` - –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞
- `POST /api/auction/external/GetStatusOrder` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
- `POST /api/auction/external/CreateDispute` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–æ—Ä–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –í–∞–ª–∏–¥–∞—Ü–∏—è RSA –ø–æ–¥–ø–∏—Å–∏ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ
- –í–æ–∑–≤—Ä–∞—Ç payment_details (–Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç/—Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤)

### 2. –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ callback'–æ–≤ ‚úÖ
**–§–∞–π–ª**: `backend/src/services/auction-callback-sender.ts`

**–§—É–Ω–∫—Ü–∏–∏**:
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö callback'–æ–≤ –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—É–º–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ–ª–æ—É ‚úÖ
**–û–±–Ω–æ–≤–ª–µ–Ω**: `backend/src/routes/merchant/index.ts`

**–õ–æ–≥–∏–∫–∞**:
- –ê—É–∫—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä—á–∞–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã (–∫–æ–º–∏—Å—Å–∏–∏, –∑–∞–º–æ—Ä–æ–∑–∫–∞, –ø—Ä–∏–±—ã–ª—å) –æ—Å—Ç–∞—é—Ç—Å—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏

### 4. –ê–¥–º–∏–Ω–∫–∞ ‚úÖ
**–§–∞–π–ª**: `backend/src/routes/admin/auction.ts`

**Endpoints**:
- `POST /admin/auction/generate-keys/{merchantId}` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è RSA –∫–ª—é—á–µ–π
- `PUT /admin/auction/toggle/{merchantId}` - –≤–∫–ª—é—á–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- `GET /admin/auction/download-key/{merchantId}/{keyType}` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π
- `GET /admin/auction/status/{merchantId}` - —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ—Ä—á–∞–Ω—Ç–∞

### –ü–æ–ª—è –≤ –ë–î:
```sql
isAuctionEnabled     BOOLEAN  -- –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –∞—É–∫—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
auctionBaseUrl       TEXT     -- URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ callback'–æ–≤ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ
rsaPublicKeyPem      TEXT     -- –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π
rsaPrivateKeyPem     TEXT     -- –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ callback'–æ–≤
externalSystemName   TEXT     -- –∏–º—è –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
keysGeneratedAt      TIMESTAMP -- –¥–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
1. –í–∫–ª—é—á–∏—Ç—å `isAuctionEnabled = true`
2. –£–∫–∞–∑–∞—Ç—å `auctionBaseUrl` - –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å callback'–∏
3. –£–∫–∞–∑–∞—Ç—å `externalSystemName` - –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å RSA –∫–ª—é—á–∏
5. –ü–µ—Ä–µ–¥–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –í–Ω–µ—à–Ω—è—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —É –Ω–∞—Å:

```bash
curl -X POST "https://api.chasepay.pro/auction/external/CreateOrder" \
  -H "Content-Type: application/json" \
  -H "X-Timestamp: 1706534400" \
  -H "X-Signature: dGVzdF9zaWduYXR1cmU=" \
  -d '{
    "system_order_id": "ext-order-123",
    "currency": "RUB",
    "amount": 1000,
    "max_exchange_rate": 120,
    "max_commission": 5,
    "cancel_order_time_unix": 1706538000,
    "stop_auction_time_unix": 1706534430,
    "callback_url": "https://external-system.com/callback",
    "allowed_payment_method": "sbp"
  }'
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "is_success": true,
  "external_order_id": "tx-456-789",
  "payment_details": {
    "type": "sbp",
    "phone_number": "+79001234567",
    "bank_name": "–°–±–µ—Ä–±–∞–Ω–∫",
    "name": "–û–û–û –ö–æ–º–ø–∞–Ω–∏—è"
  },
  "exchange_rate": 95.0,
  "commission": 3.0
}
```

### 2. –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º callback –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ:

```bash
# –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
curl -X POST "https://external-system.com/callback" \
  -H "Content-Type: application/json" \
  -H "X-Timestamp: 1706534500" \
  -H "X-Signature: callback_signature_here" \
  -d '{
    "order_id": "ext-order-123",
    "status_id": 6,
    "amount": 1000
  }'
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞

1. **–í–Ω–µ—à–Ω—è—è —Å–∏—Å—Ç–µ–º–∞** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `CreateOrder` ‚Üí **–ù–ê–ú**
2. **–ú–´** —Å–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, –Ω–∞—Ö–æ–¥–∏–º —Ç—Ä–µ–π–¥–µ—Ä–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
3. **–ú–´** –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º callback (status_id: 1 - —Å–æ–∑–¥–∞–Ω–∞) ‚Üí **–í–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ**
4. –¢—Ä–µ–π–¥–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑ –∫–∞–∫ –æ–±—ã—á–Ω–æ
5. **–ú–´** –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º callback (status_id: 6 - –∑–∞–≤–µ—Ä—à–µ–Ω–∞) ‚Üí **–í–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ**

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RSA –ø–æ–¥–ø–∏—Å—å:
- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–Ω—É—é –ø–æ–¥–ø–∏—Å—å
- –í—Å–µ –∏—Å—Ö–æ–¥—è—â–∏–µ callback'–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞—à–∏–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º
- –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ ¬±120 —Å–µ–∫—É–Ω–¥ –¥–ª—è timestamp

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ—Ä—á–∞–Ω—Ç–∞ –ø–æ external_system_name
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–π–¥–µ—Ä–æ–≤ –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤ –ø–ª–∞—Ç–µ–∂–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- –í—Å–µ –∏—Å—Ö–æ–¥—è—â–∏–µ callback'–∏
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–µ–π
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ callback'–æ–≤
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üöÄ –ì–æ—Ç–æ–≤—ã–µ endpoints

### –î–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º:
- `POST /api/auction/external/CreateOrder`
- `POST /api/auction/external/CancelOrder`
- `POST /api/auction/external/GetStatusOrder`
- `POST /api/auction/external/CreateDispute`

### –î–ª—è –∞–¥–º–∏–Ω–∫–∏:
- `POST /api/admin/auction/generate-keys/{merchantId}`
- `PUT /api/admin/auction/toggle/{merchantId}`
- `GET /api/admin/auction/download-key/{merchantId}/{keyType}`
- `GET /api/admin/auction/status/{merchantId}`

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∞—É–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º —Å:
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏–µ–π RSA –ø–æ–¥–ø–∏—Å–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∏–∑ –Ω–∞—à–∏—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –∫–∞–∫ –≤ –æ–±—ã—á–Ω–æ–º —Ñ–ª–æ—É
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–æ–π callback'–æ–≤ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ü–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π
