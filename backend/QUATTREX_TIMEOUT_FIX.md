# Исправление проблемы с таймаутом агрегатора Quattrex

## Проблема
Запросы к агрегатору Quattrex (https://quattrex.pro/api/merchant/transactions/in) превышали установленный таймаут в 30 секунд, что приводило к ошибке "timeout of 30000ms exceeded".

## Анализ
1. **Время ответа**: 30016ms (превышает лимит на 16ms)
2. **Агрегатор**: Test Aggregator Fixed (ID: cmfdynee902gmikvwlqtn1je1)
3. **Настройки**: maxSlaMs был установлен в 30000ms
4. **Тип**: Chase-совместимый агрегатор

## Внесенные изменения

### 1. Увеличен таймаут для агрегатора Quattrex
- Обновлен `maxSlaMs` с 30000ms до 60000ms (60 секунд)
- Изменение применено только к активному агрегатору

### 2. Исправлены жестко заданные таймауты в коде
- В `backend/src/services/aggregator.service.ts` заменены все жестко заданные таймауты 30000ms на `aggregator.maxSlaMs || 30000`
- Теперь все запросы к агрегаторам используют настройки из базы данных

## Скрипты для мониторинга

### Проверка настроек агрегатора
```bash
npx tsx check-quattrex-aggregator.ts
```

### Тестирование таймаута
```bash
npx tsx test-quattrex-timeout.ts
```

### Мониторинг логов
```bash
npx tsx monitor-aggregator-logs.ts
```

## Рекомендации

1. **Мониторинг**: Регулярно проверяйте логи интеграции на предмет нарушений SLA
2. **Настройка таймаутов**: Для каждого агрегатора устанавливайте адекватные значения maxSlaMs в зависимости от их производительности
3. **Fallback**: Система автоматически переключается на следующий агрегатор при превышении таймаута
4. **Алерты**: Настройте уведомления при частых нарушениях SLA

## Проверка результата
После внесения изменений:
- Таймаут увеличен до 60 секунд
- Запросы к Quattrex должны проходить успешно
- Система продолжает работать с fallback на другие агрегаторы при необходимости
